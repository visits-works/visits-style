{"version":3,"file":"modal.story-44fe6412.js","sources":["../../src/components/Modal/index.tsx"],"sourcesContent":["import React, { HTMLAttributes, useEffect, useRef, MouseEvent } from 'react';\nimport styled from 'styled-components';\nimport {\n  useFloating,\n  useDismiss,\n  useInteractions,\n  useTransitionStyles,\n  FloatingOverlay,\n  useId,\n} from '@floating-ui/react';\n\nimport Box from '../../elements/Box';\nimport Portal from '../Portal';\nimport { ColorType } from '../../types';\n\nexport interface Props extends HTMLAttributes<HTMLDivElement> {\n  /** trueの場合、モーダルを表示します。 */\n  show?: boolean;\n  /** モーダルのbodyに入れる内容 */\n  children?: React.ReactNode;\n  /**\n   * モーダルのbackground色\n   * @default 'background'\n   */\n  color?: ColorType;\n  /** モーダルを閉じる処理 */\n  closeModal: () => void;\n  /** オーバーレイのクリックでモーダルクローズ */\n  closeOnOverlay?: boolean;\n  /** escボタンでクローズ */\n  closeOnEsc?: boolean;\n  /**\n   * モーダルの表示・非表示のアニメーション速度\n   * @default 200\n   */\n  timeout?: number;\n  /**\n   * モーダル外に表示するElements\n   * \\\n   * もしclick eventがある場合はstopPropagationをしないとモーダルが閉じられます。\n   */\n  external?: React.ReactNode;\n  /** モーダルのtransition exitが完了した時に発火されるcallback */\n  onExited?: () => void;\n}\n\nfunction stopPropagation(e?: React.MouseEvent<Element>) {\n  if (!e) return;\n  e.stopPropagation();\n}\n\nexport default function Modal({\n  show, children, timeout = 200,\n  color = 'background', closeModal, external,\n  closeOnOverlay, closeOnEsc, onExited,\n  ...rest\n}: Props) {\n  const exitRef = useRef(onExited);\n  const isTransMountedRef = useRef(false);\n  const id = useId();\n\n  const { refs, context } = useFloating({ open: show, onOpenChange: closeModal, nodeId: id });\n\n  const { getFloatingProps } = useInteractions([\n    useDismiss(context, {\n      enabled: closeOnEsc,\n      outsidePress: false,\n      escapeKey: closeOnEsc,\n    }),\n  ]);\n\n  const { isMounted, styles } = useTransitionStyles(context, {\n    duration: timeout,\n    initial: {\n      opacity: 0,\n      transform: 'scale(0.8)',\n    },\n  });\n\n  useEffect(() => {\n    if (isTransMountedRef.current === isMounted) return;\n    isTransMountedRef.current = isMounted;\n    if (isMounted) return;\n\n    exitRef.current?.();\n  }, [isMounted]);\n\n  const handleOverlayClose = (e: MouseEvent<HTMLDivElement>) => {\n    if (!closeOnOverlay) return;\n    closeModal?.();\n  };\n\n  exitRef.current = onExited;\n\n  return (\n    <Portal>\n      {isMounted ? (\n        <Overlay lockScroll data-testid=\"vs-modal-overlay\" onClick={handleOverlayClose}>\n          <Wrapper ref={refs.setFloating} role=\"dialog\" style={styles} onClick={stopPropagation}>\n            <Box role=\"document\" color={color} {...getFloatingProps(rest)}>\n              {children}\n            </Box>\n            {external}\n          </Wrapper>\n        </Overlay>\n      ) : null}\n    </Portal>\n  );\n}\n\nconst Overlay = styled(FloatingOverlay)`  \n  display: flex;\n  display: grid;\n  place-items: center;\n  align-items: center;\n  justify-content: center;\n  background: ${({ theme }) => theme.backdrop};\n  padding: 0.85rem;\n  z-index: 9997;\n`;\n\nconst Wrapper = styled.div`\n  will-change: transform, opacity;\n  transform-origin: center top;\n  transition-timing-function: cubic-bezier(0.645, 0.045, 0.355, 1);\n  z-index: 9999;\n`;\n"],"names":["stopPropagation","e","Modal","show","children","color","closeModal","external","closeOnOverlay","closeOnEsc","onExited","exitRef","useRef","isTransMountedRef","id","useId","refs","context","getFloatingProps","isMounted","styles","timeout","useEffect","handleOverlayClose","jsx","Portal","Overlay","jsxs","Wrapper","Box","rest","styled","FloatingOverlay","theme"],"mappings":"4vBA8CA,SAAAA,GAAAC,EAAA,CACEA,GACAA,EAAAA,gBAAAA,CACF,CAEA,SAAAC,EAAA,CAA8B,KAAAC,EAC5BA,SAAAA,EAAMC,QAAAA,EAAAA,IAAoB,MAAAC,EAAA,aAClB,WAAAC,EAAcA,SAAAA,EAAYC,eAAAA,EAClCC,WAAAA,EAAgBC,SAAAA,EAAYC,GAAAA,CAEvB,EAAA,CACL,MAAAC,EAAAC,SAAAF,CAAA,EACAG,EAAAD,SAAA,EAAA,EACAE,EAAAC,IAEA,CAAM,KAAAC,EAAEA,QAAAA,CAAMC,EAAAA,GAAAA,CAAwB,KAAAd,EAAQA,aAAAA,EAAoBG,OAAAA,CAAoBQ,CAAAA,EAEtF,CAAM,iBAAAI,CAAEA,EAAAA,GAAAA,CAAAA,GAAAA,EAAAA,CACc,QAAAT,EACTA,aAAAA,GACK,UAAAA,CACHA,CAAAA,CAAAA,CAAAA,EAIf,CAAM,UAAAU,EAAEA,OAAAA,CAAWC,EAAAA,GAAAA,EAAAA,CAAwC,SAAAC,EAC/CA,QAAAA,CACD,QAAA,EACE,UAAA,YACE,CACb,CAAA,EAGFC,EAAAA,UAAAA,IAAAA,OACET,EAAA,UAAAM,IACAN,EAAAA,QAAAA,EACA,CAAAM,KAEAR,EAAAA,EAAAA,UAAAA,MAAAA,EAAAA,KAAAA,IAAkB,EAAA,CAAAQ,CAAA,CAAA,EAGpB,MAAAI,EAAAtB,GAAA,CACEO,IACAF,GAAAA,MAAAA,IAAa,EAGfK,OAAAA,EAAAA,QAAAA,EAEAa,EAAA,IAAAC,GAAA,CAAA,SAAAN,EAAAK,EAAA,IAAAE,GAAA,CAAA,WAAA,GAAA,cAAA,mBAAA,QAAAH,EAAA,SAAAI,EAAA,KAAAC,GAAA,CAAA,IAAAZ,EAAA,YAAA,KAAA,SAAA,MAAAI,EAAA,QAAApB,GAAA,SAAA,CAKUwB,MAAAK,GAAA,CAAA,KAAA,WAAA,MAAAxB,EAAA,GAAAa,EAAAY,CAAA,EAAA,SAAA1B,EAAA,EAEAG,CACCA,CAAAA,CAAAA,CAAAA,CAAAA,EAAAA,IAAAA,CAAAA,CAMb,CAEA,MAAAmB,GAAAK,EAAAC,EAAA,EAAA,WAAA,CAAuC,YAAA,iBAAA,YAAA,aAAA,CAAA,EAAA,CAAA,wGAAA,gCAAA,EAAA,CAAA,CAMtB,MAAAC,CAAQ,IAAAA,EAAA,QAAA,EAKzBL,GAAAG,EAAA,IAAA,WAAA,CAA0B,YAAA,iBAAA,YAAA,aAAA,CAAA,EAAA,CAAA,sIAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}