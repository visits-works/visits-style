{"version":3,"file":"accordion.story-0d3f17fb.js","sources":["../../src/components/Accordion/index.tsx"],"sourcesContent":["import React, { HTMLAttributes, useRef, useEffect } from 'react';\nimport styled from 'styled-components';\n\nimport useIsomorphicLayoutEffect from '../../hooks/useIsomorphicLayoutEffect';\n\nexport interface Props extends HTMLAttributes<HTMLDivElement> {\n  /** ボタンなどの表示するラベル */\n  header: any;\n  show: boolean;\n  /**\n   * アニメーションの時間\n   * @default 300\n   */\n  timeout?: number;\n}\n\nexport default function Accordion({ header, show, children, timeout = 300, ...rest }: Props) {\n  const ref = useRef<HTMLDivElement | null>(null);\n  const prevHeight = useRef<number>(0);\n  const timeoutRef = useRef<number>(0);\n  const init = useRef(true);\n\n  useEffect(() => { timeoutRef.current = timeout; }, [timeout]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!ref.current) return;\n    ref.current.style.overflow = 'hidden';\n    ref.current.style.opacity = '1';\n\n    if (init.current) {\n      init.current = false;\n      ref.current.style.height = show ? 'auto' : '0px';\n      if (show) {\n        // cache prev calculated height after 1 frame draw\n        requestAnimationFrame(() => {\n          if (ref.current) {\n            prevHeight.current = ref.current.offsetHeight;\n          }\n        });\n      } else {\n        // explicitly calculate auto height\n        requestAnimationFrame(() => {\n          if (ref.current) {\n            ref.current.style.height = 'auto';\n            prevHeight.current = ref.current.offsetHeight;\n            ref.current.style.height = '0px';\n          }\n        });\n        ref.current.style.opacity = '0';\n      }\n      return;\n    }\n\n    if (!show) {\n      ref.current.style.height = `${prevHeight.current}px`;\n    }\n\n    const frameIds = [] as number[];\n    frameIds[0] = requestAnimationFrame(() => {\n      frameIds[1] = requestAnimationFrame(() => {\n        if (!ref.current) return;\n        ref.current.style.height = `${show ? prevHeight.current : 0}px`;\n        ref.current.style.opacity = show ? '1' : '0';\n      });\n    });\n\n    const timeoutId = setTimeout(() => {\n      if (!ref.current) return;\n      if (show) {\n        ref.current.style.height = 'auto';\n        ref.current.style.overflow = '';\n        ref.current.style.opacity = '';\n\n        // cache prev calculated height after 1 frame draw\n        requestAnimationFrame(() => {\n          if (ref.current) {\n            prevHeight.current = ref.current.offsetHeight;\n          }\n        });\n      } else {\n        ref.current.style.height = '0px';\n      }\n    }, timeoutRef.current);\n\n    return () => {\n      frameIds.forEach(cancelAnimationFrame);\n      clearTimeout(timeoutId);\n    };\n  }, [show]);\n\n  return (\n    <div {...rest}>\n      {header}\n      <AnimatedContent\n        aria-hidden={!show}\n        ref={ref}\n        style={{ transitionDuration: `${timeout}ms` }}\n      >\n        {children}\n      </AnimatedContent>\n    </div>\n  );\n}\n\nconst AnimatedContent = styled.div`\n  will-change: opacity, height, transform;\n  transition-property: opacity, height, transform;\n  transition-timing-function: ease-in-out;\n`;\n"],"names":["Accordion","header","show","children","rest","ref","useRef","prevHeight","timeoutRef","init","useEffect","timeout","useIsomorphicLayoutEffect","requestAnimationFrame","frameIds","timeoutId","clearTimeout","jsxs","AnimatedContent","styled"],"mappings":"yPAgBA,SAAAA,EAAA,CAAkC,OAAAC,EAAEA,KAAAA,EAAQC,SAAAA,EAAMC,QAAAA,EAAAA,IAAoB,GAAAC,CAAoB,EAAA,CACxF,MAAAC,EAAAC,SAAA,IAAA,EACAC,EAAAD,SAAA,CAAA,EACAE,EAAAF,SAAA,CAAA,EACAG,EAAAH,SAAA,EAAA,EAEAI,OAAAA,EAAAA,UAAAA,IAAAA,CAAkBF,EAAAA,QAAAA,CAAqBG,EAAAA,CAAAA,CAAAA,CAAAA,EAEvCC,EAAAA,IAAAA,CACE,GAAA,CAAAP,EAAA,QAAkB,OAIlB,GAHAA,EAAAA,QAAAA,MAAAA,SAAAA,SACAA,EAAAA,QAAAA,MAAAA,QAAAA,IAEAI,EAAA,QAAA,CACEA,EAAAA,QAAAA,GACAJ,EAAAA,QAAAA,MAAAA,OAAAA,EAAAA,OAAAA,MACAH,EAEEW,sBAAAA,IAAAA,CACER,EAAA,UACEE,EAAAA,QAAAA,EAAAA,QAAAA,aACF,CAAA,GAIFM,sBAAAA,IAAAA,CACER,EAAA,UACEA,EAAAA,QAAAA,MAAAA,OAAAA,OACAE,EAAAA,QAAAA,EAAAA,QAAAA,aACAF,EAAAA,QAAAA,MAAAA,OAAAA,MACF,CAAA,EAEFA,EAAAA,QAAAA,MAAAA,QAAAA,KAEF,MAAA,CAGFH,IACEG,EAAAA,QAAAA,MAAAA,OAAAA,GAAAA,EAAAA,OAAAA,MAGF,MAAAS,EAAA,CAAA,EACAA,EAAAA,CAAAA,EAAAA,sBAAAA,IAAAA,CACEA,EAAAA,CAAAA,EAAAA,sBAAAA,IAAAA,CACET,EAAA,UACAA,EAAAA,QAAAA,MAAAA,OAAAA,GAAAA,EAAAA,EAAAA,QAAAA,CAAAA,KACAA,EAAAA,QAAAA,MAAAA,QAAAA,EAAAA,IAAAA,IAAyC,CAAA,CAC1C,CAAA,EAGH,MAAAU,EAAA,WAAA,IAAA,CACEV,EAAA,UACAH,GACEG,EAAAA,QAAAA,MAAAA,OAAAA,OACAA,EAAAA,QAAAA,MAAAA,SAAAA,GACAA,EAAAA,QAAAA,MAAAA,QAAAA,GAGAQ,sBAAAA,IAAAA,CACER,EAAA,UACEE,EAAAA,QAAAA,EAAAA,QAAAA,aACF,CAAA,GAGFF,EAAAA,QAAAA,MAAAA,OAAAA,MACF,EAAAG,EAAA,OAAA,EAGF,MAAA,IAAA,CACEM,EAAAA,QAAAA,oBAAAA,EACAE,aAAAA,CAAAA,CAAsB,CACxB,EAAA,CAAAd,CAAA,CAAA,EAGFe,EAAA,KAAA,MAAA,CAAA,GAAAb,EAAA,SAAA,CAEKH,EAAAA,EAAAA,IAAAA,EAAAA,CAAAA,cAAAA,CAAAA,EAAAA,IAAAA,EAAAA,MAAAA,CAIQ,mBAAA,GAAAU,CAAA,IAAiC,EAAA,SAAAR,CAAA,CAAA,CAG1C,CAAA,CAAA,CAGN,CAEA,MAAAe,EAAAC,EAAA,IAAA,WAAA,CAAkC,YAAA,6BAAA,YAAA,cAAA,CAAA,EAAA,CAAA,2HAAA,CAAA;;;;;;;;"}